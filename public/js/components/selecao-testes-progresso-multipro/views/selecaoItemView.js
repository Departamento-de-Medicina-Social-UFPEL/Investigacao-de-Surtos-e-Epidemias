// Generated by CoffeeScript 1.8.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['marionette'], function(Marionette) {
  var ItemListaCaso;
  return ItemListaCaso = (function(_super) {
    __extends(ItemListaCaso, _super);

    function ItemListaCaso() {
      return ItemListaCaso.__super__.constructor.apply(this, arguments);
    }

    ItemListaCaso.prototype.template = '#selecao-testes-progresso-itemView';

    ItemListaCaso.prototype.className = 'item-lista-caso-selecao-progresso';

    ItemListaCaso.prototype.initialize = function() {
      var g, lockTesteFinal, progresso, rs, user;
      user = App.user, progresso = App.progresso;
      if (user) {
        rs = progresso.where({
          'atividade': this.model.get('_id')
        }).map(function(i) {
          return i.attributes;
        });
        g = progresso.geral;
        lockTesteFinal = false;
        if (!((g.percCasosConcluTotal >= 70) && (g.percGeralAcertoCasos >= 70))) {
          lockTesteFinal = true;
        }
      }
      this.model.set({
        'respostas': rs || []
      });
      return this.model.set({
        lockTesteFinal: lockTesteFinal
      });
    };

    ItemListaCaso.prototype.events = {
      'click': 'gotoCaso',
      'click .gotoInicial': 'gotoInicial',
      'click .gotoFinal': 'gotoFinal'
    };

    ItemListaCaso.prototype.gotoCaso = function() {
      var url;
      url = "comp/selecao-testes-progresso-multipro/teste-bloqueado";
      console.log(App.masterFinalLock);
      if (!App.masterFinalLock()) {
        url = App['selecao-testes-progresso'].routeFactory(this.model.get('_id'));
      }
      return Backbone.history.navigate(url, {
        trigger: true
      });
    };

    ItemListaCaso.prototype.gotoInicial = function() {
      var inicialDaPro, p, proMap, uPro, _id;
      p = App.user.profissional;
      proMap = {
        '1': 1,
        '2': 0,
        '3': 2
      };
      uPro = proMap[p];
      inicialDaPro = App.testes.filter(function(d) {
        return /inicial/img.test(d.get('titulo')) && d.get('pro')[uPro];
      })[0];
      if (!inicialDaPro) {
        Backbone.history.navigate("comp/selecao-testes-progresso", {
          trigger: true
        });
      }
      _id = inicialDaPro.get('_id');
      return Backbone.history.navigate("comp/teste-progresso/" + _id, {
        trigger: true
      });
    };

    ItemListaCaso.prototype.gotoFinal = function() {
      var finalDaPro, p, proMap, uPro, _id;
      p = App.user.profissional;
      proMap = {
        '1': 1,
        '2': 0,
        '3': 2,
        '0': 9
      };
      uPro = proMap[p];
      if ((uPro === 9) || App.masterFinalLock()) {
        return Backbone.history.navigate("comp/selecao-testes-progresso-multipro/teste-bloqueado", {
          trigger: true
        });
      }
      finalDaPro = App.testes.filter(function(d) {
        return /final/img.test(d.get('titulo')) && d.get('pro')[uPro];
      })[0];
      _id = finalDaPro.get('_id');
      return Backbone.history.navigate("comp/teste-progresso/" + _id, {
        trigger: true
      });
    };

    ItemListaCaso.prototype.onRender = function() {};

    return ItemListaCaso;

  })(Marionette.ItemView);
});
