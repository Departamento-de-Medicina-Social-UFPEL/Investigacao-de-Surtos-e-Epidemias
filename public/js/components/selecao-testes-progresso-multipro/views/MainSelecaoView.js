// Generated by CoffeeScript 2.7.0
define(['marionette'], function(Marionette) {
  var MainSelecaoLayout;
  return MainSelecaoLayout = (function() {
    class MainSelecaoLayout extends Marionette.ItemView {
      initialize() {
        var progresso, user;
        ({user, progresso} = App);
        this.collection.each(function(teste) {
          var g, lockTesteFinal, rs;
          if (user) {
            rs = progresso.where({
              'atividade': teste.get('_id')
            }).map(function(i) {
              return i.attributes;
            });
            g = progresso.geral;
            lockTesteFinal = false;
            if (!((g.percCasosConcluTotal >= 70) && (g.percGeralAcertoCasos >= 70))) {
              lockTesteFinal = true;
            }
          }
          teste.set({
            'respostas': rs || []
          });
          return teste.set({lockTesteFinal});
        });
        return this;
      }

      emitirCertificado(evt) {
        evt.stopPropagation();
        return App.execute('certificado', function() {
          return console.log(arguments);
        });
      }

      gotoTeste(evt) {
        var id, isPos, lock, teste, url;
        id = $(evt.target).closest('.teste').data('id');
        url = "comp/selecao-testes-progresso/teste-bloqueado";
        lock = App.masterFinalLock();
        teste = App.testes.where({
          _id: id
        });
        isPos = false;
        if (teste.length > 0) {
          isPos = teste[0].get('posTeste');
        }
        if (!(isPos && lock)) {
          url = App['selecao-testes-progresso-multipro'].routeFactory(id);
        }
        console.log(id, url, lock, isPos);
        return Backbone.history.navigate(url, {
          trigger: true
        });
      }

      onRender() {
        return this.$el.find('.teste').on('click', this.gotoTeste);
      }

    };

    MainSelecaoLayout.prototype.template = '#selecao-testes-progresso-multipro-main';

    MainSelecaoLayout.prototype.className = 'container selecao-teste-multipro';

    MainSelecaoLayout.prototype.events = {
      'click .emitir-certificado': 'emitirCertificado'
    };

    return MainSelecaoLayout;

  }).call(this);
});

// console.log @collection
