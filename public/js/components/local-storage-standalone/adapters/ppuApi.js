// Generated by CoffeeScript 2.7.0
define(['underscore', 'ppuStore'], function(_, PPUStore) {
  var PPU;
  return PPU = (function() {
    class PPU {
      constructor(options, callback1) {
        var settings;
        this.callback = callback1;
        settings = {
          config: this.configModel(),
          separator: '_',
          callback: function() {}
        };
        if (_.isString(options)) {
          settings.config = JSON.parse(options);
        } else {
          if (options.config) {
            settings.config = options.config;
          }
          if (options.callback) {
            this.callback = options.callback;
          }
        }
        if (options) {
          _.extend(settings, options);
        }
        this.separator = settings.separator;
        this.config = settings.config;
        this.configLoaded = true;
        this.init();
      }

      sameResourceStores() {
        var instAcro, lookup, name, p, sep;
        if (!this.isInited) {
          return;
        }
        p = this.config.Persistence;
        sep = this.separator;
        [instAcro, name] = ['InstitutionAcronym', 'Name'].map(function(key) {
          return p[key].replace(/[_-]/img, this.separator);
        });
        lookup = new RegExp(`${instAcro}${sep}\\d{4}${sep}${name}.*`);
        return _.filter(_.keys(localStorage), function(k) {
          return lookup.test(k);
        });
      }

      init() {
        this.basePrefix = this.getBasePrefix();
        this.store = new PPUStore({
          'namespace': this.basePrefix,
          'separator': this.separator
        });
        this.isInited = true;
        return callback.apply(this);
      }

      getUser() {
        return localStorage.getItem("PPUPLAYER_USER");
      }

      getBasePrefix() {
        var p;
        p = this.config.Persistence;
        return [p.InstitutionAcronym, p.Version, p.Name].join(this.separator);
      }

      configModel() {
        return {
          'Institution': {
            'ID_Arouca': 0,
            'Acronym': '',
            'Name': ''
          },
          'Resource': {
            'Name': '',
            'Language': '',
            'CreationDate': '',
            'Review': 0,
            'ReviewDate': '1969-12-31',
            'InteractionEstimatedTimeMinutes': 0,
            'CoverImage': ''
          },
          'SupportedDevices': [''],
          'Video': {
            'Formats': [''],
            'Resolutions': ['']
          },
          'Persistence': {
            'InstitutionAcronym': '',
            'Version': '',
            'Name': '',
            'LTIValue': false
          }
        };
      }

    };

    PPU.configLoaded = false;

    PPU.isInited = false;

    PPU.basePrefix = '';

    PPU.separator = '_';

    PPU.store = false;

    return PPU;

  }).call(this);
});
