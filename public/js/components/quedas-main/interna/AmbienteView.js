// Generated by CoffeeScript 1.8.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['./ImagePile'], function(ImageItemView) {
  var InternaMainView;
  InternaMainView = (function(_super) {
    __extends(InternaMainView, _super);

    function InternaMainView() {
      return InternaMainView.__super__.constructor.apply(this, arguments);
    }

    InternaMainView.prototype.className = 'item quedas interna container';

    InternaMainView.prototype.template = '#quedas-main-interna';

    InternaMainView.prototype.initialize = function() {
      var imagens, pasta;
      console.log(this.model);
      this.orientacoes = this.model.get('resources');
      pasta = this.model.get('folder');
      imagens = [];
      this.orientacoes = this.orientacoes.map(function(ori) {
        var img, _i, _len, _ref;
        if (!ori.imagens) {
          return false;
        }
        _ref = ori.imagens;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          img = _ref[_i];
          if (img.el) {
            continue;
          }
          img.src = "" + defaultStaticFileService + "/img/" + pasta + "/" + pasta + "_" + img.url + ".png";
          img.ori = ori;
          imagens.push(img);
        }
        return ori;
      });
      this.pasta = pasta;
      this.imagens = imagens;
      this.collection = new Backbone.Collection(imagens);
      return console.log(imagens);
    };

    InternaMainView.prototype.childViewContainer = '.image-pile';

    InternaMainView.prototype.childView = ImageItemView;

    InternaMainView.prototype.ui = {
      'images': '.image-pile',
      'slices': '.slices svg >',
      'contador': '.contador',
      'desisto': '.btn-desisto',
      'msg': '.full-msg',
      'gotoContent': '.btn-goto-content',
      'msgFinal': '.concluiu-msg',
      'closeConcluido': '.btn-close-concluido'
    };

    InternaMainView.prototype.events = {
      'click @ui.slices': 'showOrienta',
      'click @ui.desisto': 'showOrientacoes',
      'click @ui.msg': 'showContent',
      'click @ui.closeConcluido': 'closeConcluido'
    };

    InternaMainView.prototype.showContent = function() {
      return this.ui.msg.fadeOut();
    };

    InternaMainView.prototype.closeConcluido = function() {
      return this.ui.msgFinal.fadeOut();
    };

    InternaMainView.prototype.onRender = function(view) {
      this.ui.contador.find(".total").text(this.imagens.length);
      this.ui.contador.find(".feitos").text('0');
      this.$el.addClass(this.model.get('folder'));
      $('body').on('click', function(e) {
        var nehPopover, ntemPopAberto;
        nehPopover = $(e.target).data('toggle') !== 'popover';
        ntemPopAberto = $(e.target).parents('.popover.in').length === 0;
        if (nehPopover && ntemPopAberto) {
          return $('.imagem-orienta').popover('hide');
        }
      });
      window.timing = null;
      return $(window).on('resize', function() {
        if (window.openPop) {
          clearInterval(window.timing);
          return window.timing = setTimeout(function(poppper) {
            return poppper.popover('show');
          }, 200, window.openPop);
        }
      });
    };

    InternaMainView.prototype.onDestroy = function() {
      return $('.popover').remove();
    };

    InternaMainView.prototype['styles'] = {
      'glowErrado': 'drop-shadow(0 0 10px rgba(255,0,0,1))',
      'glowCerto': 'drop-shadow(0 0 10px rgba(0,255,0,1))'
    };

    InternaMainView.prototype.showOrienta = function(evt) {
      var allImg, clicadas, el, id, qry, self, tag, tagOri, targets;
      evt.stopPropagation();
      el = $(evt.target);
      id = el.prop('id');
      if (!id) {
        el = el.parent();
        id = el.prop('id');
      }
      tag = el.prop('id');
      qry = '.imagem-orienta[class*="' + tag + '"]';
      allImg = $('.imagem-orienta');
      allImg.popover('hide');
      targets = $(qry);
      self = this;
      tagOri = $(targets[0]).attr('ori');
      if (this.ui.images.find('.sombra').is(':visible')) {
        this.ui.images.find('.sombra').fadeOut();
      }
      if (id === 'sombra') {
        console.log(id);
        this.ui.images.find('.sombra').fadeIn();
      }
      console.log('agora certo', targets, qry);
      targets.each(function(a, b, c) {
        var certo, cor, style;
        certo = $(this).attr('certo');
        cor = self.styles['glowCerto'];
        $(this).attr('meClicou', true);
        style = $(this).attr('style');
        console.log(style, 1);
        style = style.split(';');
        style.push('-webkit-filter:' + cor);
        style = style.join(';');
        console.log(style, 2);
        $(this).attr('style', style);
        return console.log('css', $(this).attr('style'), style);
      });
      clicadas = $(".imagem-orienta[meClicou]").length;
      this.ui.contador.find(".feitos").text(clicadas);
      self = this;
      if ($(".imagem-orienta[meClicou]").length === self.imagens.length && !self.modalConcluido && !self.desistiu) {
        $(targets[0]).on('hidden.bs.popover', function() {
          console.log(self.desistiu, 'desistiu');
          if ($(".imagem-orienta[meClicou]").length === self.imagens.length && !self.modalAberto && !self.desistiu) {
            return self.completo();
          }
        });
      }
      return setTimeout(function(me) {
        return me.popover('show');
      }, 300, $(targets[0]));
    };

    InternaMainView.prototype.completo = function() {
      if (!this.modalConcluido) {
        this.ui.msgFinal.fadeIn();
        return this.modalConcluido = true;
      }
    };

    InternaMainView.prototype.showOrientacoes = function() {
      var self;
      self = this;
      this.ui.slices.each(function(idx, el) {
        var allImg, id, qry, tag, tagOri, targets;
        id = el.id;
        if (!id) {
          el = el.parent();
          id = el.prop('id');
        }
        tag = el.id;
        qry = ".imagem-orienta[class*=\"" + tag + "\"]";
        allImg = $('.imagem-orienta');
        targets = $(qry);
        tagOri = $(targets[0]).attr('ori');
        if (self.ui.images.find('.sombra').is(':visible')) {
          self.ui.images.find('.sombra').fadeOut();
        }
        if (id === 'sombra') {
          self.ui.images.find('.sombra').fadeIn();
        }
        return targets.each(function() {
          var certo, cor, style;
          certo = $(this).attr('meClicou');
          cor = self.styles[certo === 'true' ? 'glowCerto' : 'glowErrado'];
          style = $(this).attr('style');
          console.log(style, 1);
          style = style.split(';');
          style.push('-webkit-filter:' + cor);
          style = style.join(';');
          console.log(style, 2);
          $(this).attr('style', style);
          return console.log('css', $(this).attr('style'), style);
        });
      });
      return this.desistiu = true;
    };

    return InternaMainView;

  })(Marionette.CompositeView);
  return InternaMainView;
});
