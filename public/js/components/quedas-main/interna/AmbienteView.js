// Generated by CoffeeScript 2.7.0
define(['./ImagePile'], function(ImageItemView) {
  var InternaMainView;
  InternaMainView = (function() {
    class InternaMainView extends Marionette.CompositeView {
      initialize() {
        var imagens, pasta;
        console.log(this.model);
        this.orientacoes = this.model.get('resources');
        pasta = this.model.get('folder');
        imagens = [];
        this.orientacoes = this.orientacoes.map(function(ori) {
          var i, img, len, ref;
          if (!ori.imagens) {
            return false;
          }
          ref = ori.imagens;
          for (i = 0, len = ref.length; i < len; i++) {
            img = ref[i];
            if (img.el) {
              continue;
            }
            img.src = `${defaultStaticFileService}/img/${pasta}/${pasta}_${img.url}.png`;
            img.ori = ori;
            imagens.push(img);
          }
          return ori;
        });
        this.pasta = pasta;
        this.imagens = imagens;
        this.collection = new Backbone.Collection(imagens);
        return console.log(imagens);
      }

      showContent() {
        return this.ui.msg.fadeOut();
      }

      closeConcluido() {
        return this.ui.msgFinal.fadeOut();
      }

      onRender(view) {
        this.ui.contador.find(".total").text(this.imagens.length);
        this.ui.contador.find(".feitos").text('0');
        this.$el.addClass(this.model.get('folder'));
        $('body').on('click', function(e) {
          var nehPopover, ntemPopAberto;
          nehPopover = $(e.target).data('toggle') !== 'popover';
          ntemPopAberto = $(e.target).parents('.popover.in').length === 0;
          if (nehPopover && ntemPopAberto) {
            return $('.imagem-orienta').popover('hide');
          }
        });
        window.timing = null;
        return $(window).on('resize', function() {
          if (window.openPop) {
            clearInterval(window.timing);
            return window.timing = setTimeout(function(poppper) {
              return poppper.popover('show');
            }, 200, window.openPop);
          }
        });
      }

      // @showOrienta @atualOri
      //do @ui.manejo.hide
      onDestroy() {
        return $('.popover').remove();
      }

      showOrienta(evt) {
        var allImg, clicadas, el, id, qry, self, tag, tagOri, targets;
        evt.stopPropagation();
        el = $(evt.target);
        id = el.prop('id');
        if (!id) {
          el = el.parent();
          id = el.prop('id');
        }
        tag = el.prop('id');
        qry = '.imagem-orienta[class*="' + tag + '"]';
        allImg = $('.imagem-orienta');
        // allImg.css
        //     '-webkit-filter': 'none'
        //     'filter': 'none'
        allImg.popover('hide');
        targets = $(qry);
        self = this;
        tagOri = $(targets[0]).attr('ori');
        if (this.ui.images.find('.sombra').is(':visible')) {
          this.ui.images.find('.sombra').fadeOut();
        }
        if (id === 'sombra') {
          console.log(id);
          this.ui.images.find('.sombra').fadeIn();
        }
        console.log('agora certo', targets, qry);
        targets.each(function(a, b, c) {
          var certo, cor, style;
          certo = $(this).attr('certo');
          // cor = self.styles[ if certo is 'true' then 'glowCerto' else 'glowErrado' ]
          cor = self.styles['glowCerto'];
          $(this).attr('meClicou', true);
          // cc = {'-webkit-filter': cor, 'filter': 'url(#drop-shadow)'}
          style = $(this).attr('style');
          console.log(style, 1);
          style = style.split(';');
          style.push('-webkit-filter:' + cor);
          style = style.join(';');
          console.log(style, 2);
          $(this).attr('style', style);
          return console.log('css', $(this).attr('style'), style);
        });
        clicadas = $(".imagem-orienta[meClicou]").length;
        this.ui.contador.find(".feitos").text(clicadas);
        self = this;
        if ($(".imagem-orienta[meClicou]").length === self.imagens.length && !self.modalConcluido && !self.desistiu) {
          $(targets[0]).on('hidden.bs.popover', function() {
            console.log(self.desistiu, 'desistiu');
            if ($(".imagem-orienta[meClicou]").length === self.imagens.length && !self.modalAberto && !self.desistiu) {
              return self.completo();
            }
          });
        }
        return setTimeout(function(me) {
          return me.popover('show');
        }, 300, $(targets[0]));
      }

      //do @completo if clicadas is @imagens.length
      completo() {
        if (!this.modalConcluido) {
          this.ui.msgFinal.fadeIn();
          return this.modalConcluido = true;
        }
      }

      showOrientacoes() {
        var self;
        self = this;
        this.ui.slices.each(function(idx, el) {
          var allImg, id, qry, tag, tagOri, targets;
          id = el.id;
          if (!id) {
            el = el.parent();
            id = el.prop('id');
          }
          tag = el.id;
          qry = `.imagem-orienta[class*="${tag}"]`;
          allImg = $('.imagem-orienta');
          targets = $(qry);
          tagOri = $(targets[0]).attr('ori');
          if (self.ui.images.find('.sombra').is(':visible')) {
            self.ui.images.find('.sombra').fadeOut();
          }
          if (id === 'sombra') {
            self.ui.images.find('.sombra').fadeIn();
          }
          return targets.each(function() {
            var certo, cor, style;
            certo = $(this).attr('meClicou');
            cor = self.styles[certo === 'true' ? 'glowCerto' : 'glowErrado'];
            // cor = self.styles['glowCerto']
            // $(this).attr 'meClicou', true
            // cc = {'-webkit-filter': cor, 'filter': 'url(#drop-shadow)'}
            style = $(this).attr('style');
            console.log(style, 1);
            style = style.split(';');
            style.push('-webkit-filter:' + cor);
            style = style.join(';');
            console.log(style, 2);
            $(this).attr('style', style);
            return console.log('css', $(this).attr('style'), style);
          });
        });
        // certo = $(this).attr 'certo'
        // cor = self.styles[ if certo is 'true' then 'glowCerto' else 'glowErrado' ]
        // $(this).attr 'meClicou', true
        // $(this).css
        //   '-webkit-filter': cor
        //   'filter': 'url(#drop-shadow)'
        return this.desistiu = true;
      }

    };

    InternaMainView.prototype.className = 'item quedas interna container';

    InternaMainView.prototype.template = '#quedas-main-interna';

    InternaMainView.prototype.childViewContainer = '.image-pile';

    InternaMainView.prototype.childView = ImageItemView;

    InternaMainView.prototype.ui = {
      'images': '.image-pile',
      'slices': '.slices svg >',
      'contador': '.contador',
      'desisto': '.btn-desisto',
      'msg': '.full-msg',
      'gotoContent': '.btn-goto-content',
      'msgFinal': '.concluiu-msg',
      'closeConcluido': '.btn-close-concluido'
    };

    InternaMainView.prototype.events = {
      'click @ui.slices': 'showOrienta',
      'click @ui.desisto': 'showOrientacoes',
      'click @ui.msg': 'showContent',
      'click @ui.closeConcluido': 'closeConcluido'
    };

    InternaMainView.prototype['styles'] = {
      'glowErrado': 'drop-shadow(0 0 10px rgba(255,0,0,1))',
      'glowCerto': 'drop-shadow(0 0 10px rgba(0,255,0,1))'
    };

    return InternaMainView;

  }).call(this);
  //@ui.contador.find(".feitos").text @imagens.length
  return InternaMainView;
});
