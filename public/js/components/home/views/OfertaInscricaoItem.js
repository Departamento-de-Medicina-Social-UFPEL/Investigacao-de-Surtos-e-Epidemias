// Generated by CoffeeScript 2.7.0
define([], function() {
  var OfertaInscricaoView;
  OfertaInscricaoView = (function() {
    class OfertaInscricaoView extends Marionette.ItemView {
      initialize() {}

      inscreva() {
        console.log('inscreva-se');
        if (!this.model.get("fl_concluinte")) {
          return App.appRouter.navigate('#comp/cadastro', {
            'trigger': true
          });
        }
      }

      irProgresso() {
        if (this.model.get("fl_concluinte")) {
          return App.appRouter.navigate('#comp/progresso', {
            'trigger': true
          });
        }
      }

      trocaCor(evt) {
        var ckVal, modiNovo, modiOld;
        ckVal = $(evt.target).prop("checked");
        modiNovo = ckVal ? "success" : "danger";
        modiOld = !ckVal ? "success" : "danger";
        return $(evt.target).parent().parent().removeClass('check-' + modiOld).addClass('check-' + modiNovo);
      }

      paraClick(evt) {
        evt.preventDefault();
        return evt.stopPropagation();
      }

      verificaInscricoes() {
        var fl_inscrito, hoje, self;
        self = this;
        hoje = new Date();
        fl_inscrito = false;
        if (App.user.ofertas) {
          App.user.ofertas.forEach(function(o) {
            if (o.modulo === App.moduloId && o.conteudo === self.model.get('nucleo').toLowerCase() && o.dt_conclusao) {
              fl_inscrito = true;
              self.model.set('id_arouca', o.id_arouca);
              self.model.set('url_certificado', o.url_certificado);
              return self.model.set('fl_concluinte', true);
            } else if (o.id_arouca === self.model.get('id_arouca') && !self.model.get('fl_concluinte')) {
              return fl_inscrito = true;
            }
          });
        }
        if (fl_inscrito || self.model.get("fl_concluinte")) {
          self.$el.find("input[value=" + self.model.get('id_arouca') + "]").prop('checked', true);
          self.ui.linkInscricao.hide();
          self.ui.flInscrito.addClass('check-success');
          if (self.model.get("fl_concluinte")) {
            self.ui.flInscrito.html("<div style='margin-left: 7px;padding: 3px;'>JÃ¡ certificado!</div>");
            return self.ui.alertCertificado.removeClass('hide');
          } else {
            return self.ui.alertCertificar.removeClass('hide');
          }
        } else {
          self.ui.flInscrito.addClass('check-danger');
          self.ui.linkInscricao.show();
          return self.ui.alertInscricao.removeClass('hide');
        }
      }

      onRender() {
        this.$el.addClass(this.model.get('nucleo').toLowerCase());
        this.ui.checkInscrito.prop("checked", this.model.get('fl_inscrito'));
        return this.verificaInscricoes();
      }

    };

    OfertaInscricaoView.prototype.className = 'col-xs-12 col-sm-6 col-md-6 col-lg-6 inscricoes-item';

    OfertaInscricaoView.prototype.template = '#home-oferta-inscricao';

    OfertaInscricaoView.prototype.ui = {
      'checkInscrito': '#check-box-casos-clinicos',
      'linkInscricao': '.link-inscricao',
      'flInscrito': '#fl-inscrito',
      'alertInscricao': '#alert-inscricao',
      'alertCertificado': '#alert-certificado',
      'alertCertificar': '#alert-certificar'
    };

    OfertaInscricaoView.prototype.events = {
      'change @ui.checkInscrito': 'trocaCor',
      'click @ui.checkInscrito': 'paraClick',
      'click @ui.flInscrito': 'inscreva',
      'click @ui.alertCertificado': 'irProgresso'
    };

    return OfertaInscricaoView;

  }).call(this);
  return OfertaInscricaoView;
});
