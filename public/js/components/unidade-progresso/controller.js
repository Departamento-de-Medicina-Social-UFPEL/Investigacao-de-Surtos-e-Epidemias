// Generated by CoffeeScript 2.7.0
define(['./views/MainUnidadeView', './models/Caso', 'backbone'], function(MainUnidadeView, Caso, Backbone) {
  return {
    "unidadeBloqueada": function(callback) {
      var Modal;
      Modal = Backbone.Modal.extend({
        template: _.template($('#unidade-progresso-unidade-bloqueada').html()),
        submitEl: '.bbm-button',
        onRender: function() {
          var b;
          b = $('body');
          if (!b.is(':visible')) {
            return b.fadeIn();
          }
        },
        onDestroy: function() {
          $('body').removeAttr('style').css({
            display: 'block'
          });
          $('body').css({
            'overflow': 'auto'
          });
          return App.appRouter.navigate('/', {
            'trigger': true
          });
        }
      });
      App.modals.show(new Modal());
      if (callback) {
        return callback.apply(this);
      }
    },
    "mostraUnidade": function(unidade) {
      var appComponent, coll, mainView;
      if (!App.user) {
        return;
      }
      appComponent = _.findWhere(window.modulo.components, {
        short: unidade
      });
      console.log(unidade, 'unidade', appComponent);
      console.log(window.modulo.components, appComponent, {
        short: unidade
      }, 'appComponent unidade');
      appComponent.routeFactory = function(id) {
        return `#comp/${openItemsIn}/${id}`;
      };
      if (appComponent.externalResources) {
        appComponent.resource.casos = appComponent.resource.casos.map(function(c) {
          c.tipo = c.tipo ? c.tipo : 'caso';
          return c;
        });
      } else {
        appComponent.resource = {
          casos: []
        };
      }
      // if not App.unidade
      //   App.unidade = {}
      // App.unidade[appComponent.short] = appComponent
      // casosLean = appComponent.resource.casos

      // for c in casosLean
      //   App.atividades.add c
      //   App.casos.add c
      appComponent.testes = App.testes.models.filter(function(t) {
        return t.get('unidade') === appComponent.unidade && appComponent.unidade;
      });
      coll = Backbone.Collection.extend({
        model: Caso
      });
      mainView = new MainUnidadeView({
        collection: new coll(appComponent.resource.casos),
        model: new Backbone.Model(appComponent)
      });
      return App.main.show(mainView);
    }
  };
});

// callback.apply @ if callback
