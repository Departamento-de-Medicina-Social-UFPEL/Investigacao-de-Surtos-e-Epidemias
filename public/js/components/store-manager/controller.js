// Generated by CoffeeScript 1.8.0
define([], function() {
  return {
    "syncAll": function(cb) {
      var local, progresso, socket, user;
      local = App.local, socket = App.socket, progresso = App.progresso;
      user = local.get('user');
      App.user = user;
      progresso.setUser(user);
      if (App.socket) {
        socket.emit('user', user, function(resposta) {
          var erroServidor, u;
          if (resposta.ok) {
            if (resposta.user.cpf !== user.cpf) {
              erroServidor = "Conflito de cpf enviado: " + user.cpf + " recebido " + resposta.user.cpf;
              socket.emit('senderror', erroServidor, function(r) {
                return console.log('erro salvo no servidor');
              });
              if (cb) {
                return cb();
              }
            } else {
              u = resposta.user;
              App.user = _.extend((App.user ? App.user : {}), {
                cpf: u.cpf,
                ficha: {
                  pessoal: {
                    nome: {
                      primeiro: u.nome.slice(0, u.nome.indexOf(' ')),
                      sobrenome: lti.lis_person_name_full,
                      completo: lti.lis_person_name_full
                    }
                  }
                },
                synced: true
              });
              local.set('user', App.user);
              return progresso.setUser(App.user);
            }
          }
        });
      }
      if (cb) {
        return cb();
      }
    }
  };
});
