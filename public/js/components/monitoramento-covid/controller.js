// Generated by CoffeeScript 1.8.0
define(['backbone', './views/HomeView', './views/FormularioView', './views/FormularioLocalView', './views/LocalView', './collections/Monitoramentos', './models/Monitoramento'], function(Backbone, HomeLayout, FormularioView, FormularioLocalView, LocalView, MonitoramentosColl, Monitoramento) {
  return {
    "before": function(next) {
      var monitoramentos, socket;
      if (!App.user) {
        window.location.href = '#comp/cadastro';
      }
      socket = App.socket;
      App.monitoramentos = new MonitoramentosColl();
      if (socket.connected) {
        return socket.emit('monitoramentos', {
          user: App.user.cpf
        }, function(resposta) {
          if (resposta.ok) {
            App.monitoramentos.reset(resposta.monitoramentos);
            App.monitoramentos.saveLocal();
            if (next) {
              return next();
            }
          }
        });
      } else {
        monitoramentos = App.local.get("monitoramento-" + App.user.cpf);
        App.monitoramentos = new MonitoramentosColl(monitoramentos);
        if (next) {
          return next();
        }
      }
    },
    "main": function() {
      return this.before(function() {
        var mainView;
        mainView = new HomeLayout({
          collection: App.monitoramentos
        });
        return App.main.show(mainView);
      });
    },
    "local": function(id) {
      return this.before(function() {
        var mainView;
        mainView = new FormularioLocalView({
          model: App.monitoramentos.get(id)
        });
        return App.main.show(mainView);
      });
    },
    "monitorar": function(id) {
      return this.before(function() {
        var mainView;
        console.log('monitorar', id, App.monitoramentos.get(id), App.monitoramentos);
        mainView = new LocalView({
          model: App.monitoramentos.get(id)
        });
        return App.main.show(mainView);
      });
    },
    "novaAmostragem": function(id) {
      return this.before(function() {
        var f, mainView;
        f = new Monitoramento({
          id_local: id
        });
        mainView = new FormularioView({
          model: f
        });
        return App.main.show(mainView);
      });
    },
    "amostragem": function(id, idAmostragem) {
      return this.before(function() {
        var a, mainView;
        a = _.findWhere(App.monitoramentos.get(id).get('dados'), {
          id: idAmostragem
        });
        mainView = new FormularioView({
          model: new Monitoramento(a)
        });
        return App.main.show(mainView);
      });
    }
  };
});
