// Generated by CoffeeScript 1.8.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['backbone.modal', 'utils', 'uf_municipios'], function(ModalView, utils, Uf) {
  var Modal;
  return Modal = (function(_super) {
    __extends(Modal, _super);

    function Modal() {
      return Modal.__super__.constructor.apply(this, arguments);
    }

    Modal.prototype.initialize = function(cpf, tipo) {
      var subtitulo;
      if (App.user) {
        this.cpf = App.user.cpf;
      } else {
        this.cpf = cpf;
      }
      this.model = new Backbone.Model({
        tipo: tipo
      });
      switch (tipo) {
        case 'conclusao':
          subtitulo = 'Conclus√£o da Oferta';
          break;
        case 'encerramento':
          subtitulo = 'Encerramento de Oferta';
          break;
        default:
          subtitulo = 'Cadastro';
      }
      return this.model.set('subtitulo', subtitulo);
    };

    Modal.prototype.template = _.template($('#enquetes-introducao').html());

    Modal.prototype.submitEl = '.submit-form';

    Modal.prototype.cancelEl = '.close-modal';

    Modal.prototype.onRender = function() {
      var b;
      console.log('render enquete cadastro');
      b = $('body');
      if (!b.is(':visible')) {
        b.fadeIn();
      }
      return setTimeout((function() {
        return window.$.material.init();
      }), 10);
    };

    Modal.prototype.naoDesejo = function() {
      var UserEnquete;
      if (App.user) {
        if (!App.user.enquetes) {
          App.user['enquetes'] = {};
        }
        if (!App.user.enquetes[App.moduloId]) {
          App.user.enquetes[App.moduloId] = {};
        }
        if (!App.user.enquetes[App.moduloId][this.model.get('tipo')]) {
          App.user.enquetes[App.moduloId][this.model.get('tipo')] = {
            'naodesejoresponder': true
          };
        }
        this.destroy();
        Backbone.history.navigate('#comp/home', {
          trigger: true
        });
        UserEnquete = {
          cpf: App.user.cpf,
          modulo: App.moduloId
        };
        UserEnquete[this.model.get('tipo')] = App.user.enquetes[App.moduloId][this.model.get('tipo')];
        return App.execute('storeUserEnquete', UserEnquete, function(resposta) {
          return console.log('nao desejo responder salvo server', resposta);
        });
      }
    };

    Modal.prototype.events = {
      'click #fechar-enquete': 'naoDesejo',
      'click #btn-responder': 'responder'
    };

    Modal.prototype.responder = function() {
      Backbone.history.navigate('#comp/enquetes/' + this.model.get('tipo') + '/' + App.user.cpf, {
        trigger: true
      });
      return this.destroy();
    };

    return Modal;

  })(Backbone.Modal);
});
