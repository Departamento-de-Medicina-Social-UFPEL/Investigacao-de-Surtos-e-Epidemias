// Generated by CoffeeScript 1.8.0
define(['underscore'], function(_) {
  var PopulacaoEmFaixas;
  PopulacaoEmFaixas = (function() {
    function PopulacaoEmFaixas(faixaUf, sexoFaixaUf) {
      this.faixaPorUf = faixaUf;
      this.faixaPorRelSexo = sexoFaixaUf;
      this.faixas = _(this.faixaPorUf.map(function(v, k, l) {
        var _i, _ref, _results;
        if ((function() {
          _results = [];
          for (var _i = 1, _ref = l.length - 2; 1 <= _ref ? _i <= _ref : _i >= _ref; 1 <= _ref ? _i++ : _i--){ _results.push(_i); }
          return _results;
        }).apply(this).indexOf(k) !== -1) {
          return v[0];
        }
      })).compact().__wrapped__;
      this.ufs = {
        "RO": "Rondônia",
        "AC": "Acre",
        "AM": "Amazonas",
        "RR": "Roraima",
        "PA": "Pará",
        "AP": "Amapá",
        "TO": "Tocantins",
        "MA": "Maranhão",
        "PI": "Piauí",
        "CE": "Ceará",
        "RN": "Rio Grande do Norte",
        "PB": "Paraíba",
        "PE": "Pernambuco",
        "AL": "Alagoas",
        "SE": "Sergipe",
        "BA": "Bahia",
        "MG": "Minas Gerais",
        "ES": "Espírito Santo",
        "RJ": "Rio de Janeiro",
        "SP": "São Paulo",
        "PR": "Paraná",
        "SC": "Santa Catarina",
        "RS": "Rio Grande do Sul",
        "MS": "Mato Grosso do Sul",
        "MT": "Mato Grosso",
        "GO": "Goiás",
        "DF": "Distrito Federal"
      };
    }

    PopulacaoEmFaixas.prototype.getFaixas = function() {
      return this.faixas;
    };

    PopulacaoEmFaixas.prototype.getUfs = function() {
      return this.ufs;
    };

    PopulacaoEmFaixas.prototype.getUfBySigla = function(sigla) {
      return this.ufs[sigla.toUpperCase()];
    };

    PopulacaoEmFaixas.prototype.getFaixasPorUf = function(uf) {
      var faixa, ufCol, ufVals, _i, _len, _ref;
      ufCol = this.faixaPorRelSexo[0].indexOf(uf.toUpperCase());
      ufVals = [];
      _ref = this.faixaPorUf;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        faixa = _ref[_i];
        ufVals.push(faixa[ufCol]);
      }
      return this.getMiolo(ufVals, function(v) {
        var error;
        try {
          v = v.replace(/,/gm, '.');
        } catch (_error) {
          error = _error;
        }
        return (parseFloat(v)) / 100;
      });
    };

    PopulacaoEmFaixas.prototype.getFaixasDestSexoPorUf = function(uf) {
      var faixa, ufCol, ufVals, _i, _len, _ref;
      ufCol = this.faixaPorRelSexo[0].indexOf(uf.toUpperCase());
      ufVals = [];
      _ref = this.faixaPorRelSexo;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        faixa = _ref[_i];
        ufVals.push(faixa[ufCol]);
      }
      return this.getMiolo(ufVals, function(v) {
        var error;
        try {
          return v = v.replace(/,/gm, '.');
        } catch (_error) {
          error = _error;
        }
      });
    };

    PopulacaoEmFaixas.prototype.getData = function(uf, locPop) {
      var faix, genero, k, perF, perM, popDist, sexDist, total, upperSigla;
      popDist = this.getFaixasPorUf(uf);
      sexDist = this.getFaixasDestSexoPorUf(uf);
      console.log(locPop);
      faix = [];
      for (k in this.faixas) {
        total = locPop * popDist[k];
        genero = this.propPorGen(sexDist[k], total);
        perF = genero.F * 100;
        perM = 100 - (genero.F * 100);
        faix.push({
          nome: this.faixas[k],
          total: total,
          perTotal: popDist[k] * 100,
          totM: perM * total / 100,
          perM: perM,
          totF: perF * total / 100,
          perF: perF
        });
      }
      upperSigla = uf.toUpperCase();
      return {
        estado: this.ufs[upperSigla],
        sigla: upperSigla,
        populacao: {
          total: locPop,
          feminino: faix.reduce(function(sum, faixa) {
            sum += faixa.totF;
            return sum;
          }, 0),
          masculino: faix.reduce(function(sum, faixa) {
            return sum += faixa.totM;
          }, 0)
        },
        faixas: faix
      };
    };

    PopulacaoEmFaixas.prototype.propPorGen = function(MalesPerFemale) {
      var total, totalF, totalM;
      total = MalesPerFemale + 50;
      totalM = MalesPerFemale / total;
      totalF = 50 / total;
      return {
        M: totalM,
        F: totalF
      };
    };

    PopulacaoEmFaixas.prototype.getMiolo = function(arr) {
      var arg, ret;
      arg = arguments[1];
      ret = arr.slice(1, -1);
      if (typeof arg === 'function') {
        return ret.map(arg);
      } else {
        return ret;
      }
    };

    PopulacaoEmFaixas.prototype.findKey = function(obj, value) {
      var eh, k, v;
      console.log(arguments);
      for (k in obj) {
        v = obj[k];
        console.log(value, v, k);
        eh = v === value;
        console.log("" + v + " is " + value + " ? " + eh);
        if (eh) {
          return k;
        }
      }
    };

    return PopulacaoEmFaixas;

  })();
  return PopulacaoEmFaixas;
});
