// Generated by CoffeeScript 2.7.0
define('casca', ['js/app/views/MenuView', 'js/app/views/ProgressoLateralView', 'js/app/regions/FadeTransitionRegion', 'marionette.modals'], function(MenuView, ProgressoLateralView, FadeTransitionRegion) {
  var Casca;
  Casca = (function() {
    class Casca extends Marionette.Application {
      loadUserMenu() {
        var dtAtual, ofertasAbertas, self;
        self = this;
        $('#botaoInicial').show();
        self.menuEntries.push({
          'style': 'link',
          'link': 'https://dms.ufpel.edu.br/p2k/contato',
          'icone': 'envelope',
          'texto': "Preciso de ajuda"
        });
        self.userMenu.show(new MenuView({
          model: new Backbone.Model(self.user),
          collection: new Backbone.Collection(self.menuEntries)
        }));
        dtAtual = new Date();
        ofertasAbertas = new Backbone.Collection(window.modulo.ofertas.filter(function(o) {
          return dtAtual >= (new Date(o.data_inicio)) && (new Date(o.data_fim_matricula)) >= dtAtual;
        }));
        console.log('inicio load menu 3', ofertasAbertas);
        self.progressoLateral.show(new ProgressoLateralView({
          collection: ofertasAbertas
        }));
        return console.log('fim load menu');
      }

      start(options) {
        var andThen, classes, ref, rule, s, selector, self;
        self = this;
        self.trigger('beforeStart');
        this.addRegions({
          intro: '#introLayer',
          main: {
            selector: '#mainStage',
            regionClass: FadeTransitionRegion
          },
          footer: 'footer',
          modals: {
            selector: '.modals-container',
            regionClass: Marionette.Modals
          },
          userMenu: {
            selector: ".user-menu"
          },
          progressoLateral: {
            selector: ".user-menu-progresso"
          }
        });
        if (window.modulo.skipIntro) {
          this.hasIntro = false;
        }
        if (window.modulo.style) {
          classes = '';
          ref = window.modulo.style;
          for (selector in ref) {
            rule = ref[selector];
            s = (selector.indexOf('.') < 0) ? s = `.${selector}` : selector;
            classes += `${s}{ ${rule.join(';')} }`;
          }
          $('head').append(`<style>${classes}</style>`);
        }
        this.main.firstShow = true;
        this.main.onShow = function() {
          var ref1;
          if (!self.main.firstShow) {
            return;
          }
          // console.log "@main.on 'show', ->", self.user, self.menuEntries, self.local.get 'user menu'
          if (self.user) {
            // console.log self.menuEntries
            self.loadUserMenu();
            
            // Forçar o usuario a relogar no módulo de investigações por causa
            // do problema em salvar a etapa 2 do formulário.
            if (self.moduloId === '63758ed55ebc0215731f6c36') {
              if ((ref1 = self.user.alt_raca_cor) !== "Branco" && ref1 !== "Preto" && ref1 !== "Pardo" && ref1 !== "Amarelo" && ref1 !== "Indígena") {
                // or self.user.alt_genero not in ["F", "M", "N", "O", "R"]
                // or self.user.alt_profissao not in ["Profissional", "Estudante"]
                // or self.user.alt_atua_ambulatorio_especializado not in ["S", "N"]
                // or self.user.alt_atua_atencao_basica not in ["S", "N"]
                // or self.user.alt_atua_filantropico not in ["S", "N"]
                // or self.user.alt_atua_gestao_saude not in ["S", "N"]
                // or self.user.alt_atua_hospital_emergencia not in ["S", "N"]
                // or self.user.alt_atua_no_sus not in ["S", "N"]
                // or self.user.alt_atua_pesquisa not in ["S", "N"]
                // or self.user.alt_atua_pronto_atendimento not in ["S", "N"]
                // or self.user.alt_atua_saude_privada not in ["S", "N"]
                // or self.user.alt_atuou_vigilancia_sus not in ["A", "S", "N"]
                Backbone.history.navigate('comp/logout', {
                  'trigger': true
                });
              }
            }
          }
          // if !window.modulo.showComponentMenu
          //   $('button.navbar-toggle').hide()
          $('body').fadeIn();
          $('.navbar-fixed-top .dropdown li a').on('click', function() {
            return $(this).parents('.navbar-collapse').collapse('hide');
          });
          return self.main.firstShow = false;
        };
        if (this.hasFooter) {
          this.footer.show(this.footerView);
        }
        // @hasIntro = off
        if (this.hasIntro) {
          $('header').hide();
          $('footer').hide();
          $('body').fadeIn();
          this.intro.show(this.introView);
          andThen = function() {
            App.hasIntro = false;
            if (self.stopOnLoading) {
              return null;
            }
            $('header').fadeIn();
            $('footer').fadeIn();
            $('body').fadeIn();
            self.intro.empty();
            self.trigger('beforeHistoryStart');
            if (!Backbone.History.started) {
              return Backbone.history.start();
            }
          };
          return setTimeout(andThen, modulo.intro_img_3 ? 10000 : 6000);
        } else {
          $('body').fadeIn();
          self.trigger('beforeHistoryStart');
          if (!Backbone.History.started) {
            return Backbone.history.start();
          }
        }
      }

    };

    Casca.prototype.MenuView = MenuView;

    Casca.prototype.menuEntries = [];

    return Casca;

  }).call(this);
  return Casca;
});
