Marionette.HighCharts={views:{},models:{}},function(a){a.Serie=Backbone.Model.extend({constructor:function(a){Backbone.Model.prototype.constructor.apply(this,arguments),this.highChartsId=(a||{}).highChartsId||parseInt(_.uniqueId())},toHighChartsData:function(){return $.extend(!0,{},this.toJSON(),{id:this.highChartsId})},addPoint:function(a){this.set("data",this.get("data").concat([a]),{silent:!0}),this.trigger("add:point",this,a)}}),a.SerieCollection=Backbone.Collection.extend({model:a.Serie,toHighChartsData:function(){return this.map(function(a){return a.toHighChartsData()})}})}(Marionette.HighCharts.models),function(a){a.HighChartsOptions=Backbone.Model.extend({})}(Marionette.HighCharts.models),function(a){a.Chart=Marionette.ItemView.extend({template:!1,highChartsEvents:{},getHighChartsEvents:function(){return _.reduce(this.highChartsEvents,function(a,b,c){return a[c]=_.bind(this[b],this),a},{},this)},initialize:function(a){a=a||{},this.stockChart=a.stockChart||!1,this.initializeHighCharts(),this.bindHighChartsEvents()},initializeHighCharts:function(){var a=$.extend(!0,{series:this.collection.toHighChartsData(),chart:{events:this.getHighChartsEvents()}},this.model.toJSON());this.stockChart?this.$el.highcharts("StockChart",a):this.$el.highcharts(a)},onRender:function(){this.$el.highcharts().redraw()},bindHighChartsEvents:function(){this.listenTo(this.collection,"add",this.onAddSerie),this.listenTo(this.collection,"remove",this.onRemoveSerie),this.listenTo(this.collection,"reset",this.render),this.collection.each(this.bindHighChartsSerieEvents,this)},bindHighChartsSerieEvents:function(a){this.listenTo(a,"change",this.onSerieChange),this.listenTo(a,"add:point",this.onSerieAddPoint)},unbindHighChartsSerieEvents:function(a){this.stopListening(a)},onSerieAddPoint:function(a,b){var c=_.find(this.$el.highcharts().series,function(b){return b.options.id===a.highChartsId});c.addPoint(b)},onSerieChange:function(a){var b=a.changed,c=_.keys(b).length,d=_.find(this.$el.highcharts().series,function(b){return b.options.id===a.highChartsId});1===c&&b.data?d.setData(a.get("data")):1===c&&b.visible?d.setVisible(a.get("visible")):2===c&&b.visible&&b.data?(d.setData(a.get("data")),d.setVisible(a.get("visible"))):d.update(b)},onAddSerie:function(a){this.$el.highcharts().addSeries(a.toJSON(),{id:a.id||a.cid}),this.bindHighChartsSerieEvents(a)},onRemoveSerie:function(a){_.find(this.$el.highcharts().series,function(b){return b.options.id===a.highChartsId}).remove(),this.unbindHighChartsSerieEvents(a)},onBeforeDestroy:function(){this.$el.highcharts().destroy()}})}(Marionette.HighCharts.views);