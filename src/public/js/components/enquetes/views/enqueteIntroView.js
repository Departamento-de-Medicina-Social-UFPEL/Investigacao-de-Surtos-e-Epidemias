// Generated by CoffeeScript 2.7.0
define(['backbone.modal', 'utils', 'uf_municipios'], function(ModalView, utils, Uf) {
  var Modal;
  return Modal = (function() {
    class Modal extends Backbone.Modal {
      initialize(cpf, tipo) {
        var subtitulo;
        if (App.user) {
          this.cpf = App.user.cpf;
        } else {
          this.cpf = cpf;
        }
        this.model = new Backbone.Model({
          tipo: tipo
        });
        switch (tipo) {
          case 'conclusao':
            subtitulo = 'Conclus√£o da Oferta';
            break;
          case 'encerramento':
            subtitulo = 'Encerramento de Oferta';
            break;
          default:
            subtitulo = 'Cadastro';
        }
        return this.model.set('subtitulo', subtitulo);
      }

      // moduloId: "59a0be22a8b9ce7531974290"
      onRender() {
        var b;
        console.log('render enquete cadastro');
        b = $('body');
        if (!b.is(':visible')) {
          b.fadeIn();
        }
        return setTimeout((function() {
          return window.$.material.init();
        }), 10);
      }

      naoDesejo() {
        var UserEnquete;
        if (App.user) {
          if (!App.user.enquetes) {
            App.user['enquetes'] = {};
          }
          if (!App.user.enquetes[App.moduloId]) {
            App.user.enquetes[App.moduloId] = {};
          }
          if (!App.user.enquetes[App.moduloId][this.model.get('tipo')]) {
            App.user.enquetes[App.moduloId][this.model.get('tipo')] = {
              'naodesejoresponder': true
            };
          }
          this.destroy();
          Backbone.history.navigate('#comp/home', {
            trigger: true
          });
          UserEnquete = {
            cpf: App.user.cpf,
            modulo: App.moduloId
          };
          UserEnquete[this.model.get('tipo')] = App.user.enquetes[App.moduloId][this.model.get('tipo')];
          return App.execute('storeUserEnquete', UserEnquete, function(resposta) {
            return console.log('nao desejo responder salvo server', resposta);
          });
        }
      }

      responder() {
        Backbone.history.navigate('#comp/enquetes/' + this.model.get('tipo') + '/' + App.user.cpf, {
          trigger: true
        });
        return this.destroy();
      }

    };

    
    // console.log cpf, 'cpf', tipo, 'tipo', this.model
    Modal.prototype.template = _.template($('#enquetes-introducao').html());

    Modal.prototype.submitEl = '.submit-form';

    Modal.prototype.cancelEl = '.close-modal';

    Modal.prototype.events = {
      'click #fechar-enquete': 'naoDesejo',
      'click #btn-responder': 'responder'
    };

    return Modal;

  }).call(this);
});
