// Generated by CoffeeScript 2.7.0
define(['./selecaoItemView', 'marionette'], function(ItemView, Marionette) {
  var MainUnidadeLayout;
  return MainUnidadeLayout = (function() {
    class MainUnidadeLayout extends Marionette.CompositeView {
      gotoInicialUnidade(e) {
        var _id, inicialDaPro, u;
        u = $(e.target).data('unidade');
        this.gotoHome();
        inicialDaPro = (App.testes.filter(function(d) {
          return /inicial/img.test(d.get('titulo')) && d.get('unidade') === u;
        }))[0];
        if (!inicialDaPro) {
          Backbone.history.navigate("comp/listatestes", {
            trigger: true
          });
        }
        _id = inicialDaPro.get('_id');
        return Backbone.history.navigate(`comp/teste-progresso/${_id}`, {
          trigger: true
        });
      }

      gotoFinalUnidade(e) {
        var _id, inicialDaPro, u;
        u = $(e.target).data('unidade');
        this.gotoHome();
        inicialDaPro = (App.testes.filter(function(d) {
          return /final/img.test(d.get('titulo')) && d.get('unidade') === u;
        }))[0];
        console.log('inicialPro', inicialDaPro, u);
        if (!inicialDaPro) {
          Backbone.history.navigate("comp/listatestes", {
            trigger: true
          });
        }
        _id = inicialDaPro.get('_id');
        return Backbone.history.navigate(`comp/teste-progresso/${_id}`, {
          trigger: true
        });
      }

      gotoHome() {
        if (!App.user) {
          return Backbone.history.navigate('#comp/home', {
            trigger: true
          });
        }
      }

      gotoVideo() {
        return Backbone.history.navigate('comp/video-player/' + this.model.get('img_video_apresentacao') + '/' + this.model.get('unidade'), {
          trigger: true
        });
      }

      initialize() {
        var nuc, nucs;
        console.log(this.model, 'modelo unidade');
        // console.log @model, 'modelo unidade'
        if (!this.model.get('unidade')) {
          this.model.set('unidade', false);
        }
        if (!this.model.get('img_video_apresentacao')) {
          this.model.set('img_video_apresentacao', "");
        }
        if (!this.model.get('cor')) {
          this.model.set('corFonte', '#' + window.modulo.corPadrao);
          this.model.set('corIntro', 'eee');
          this.model.set('corElementos', window.modulo.corPadrao);
        } else {
          this.model.set('corFonte', 'white');
          this.model.set('corIntro', this.model.get('cor'));
          this.model.set('corElementos', this.model.get('cor'));
        }
        nuc = App.progresso.user.get('profissional');
        nucs = {
          '1': 1,
          '2': 0,
          '3': 2
        };
        this.model.set('nr_casos', this.collection.length);
        this.model.set('nr_atividades', this.model.get('atividades') ? this.model.get('atividades').length : 0);
        this.collection.comparator = function(at1, at2) {
          var isPro1, isPro2, nNucs1, nNucs2, pro1, pro2;
          pro1 = at1.get('pro');
          isPro1 = pro1[nucs[nuc]];
          nNucs1 = pro1.reduce(function(m, i) {
            if (i) {
              return m + 1;
            } else {
              return m;
            }
          });
          pro2 = at2.get('pro');
          isPro2 = at2.get('pro')[nucs[nuc]];
          nNucs2 = pro2.reduce(function(m, i) {
            if (i) {
              return m + 1;
            } else {
              return m;
            }
          });
          if (isPro1 && isPro2) {
            if (nNucs1 < nNucs2) {
              return -1;
            } else if (nNucs1 > nNucs2) {
              return 1;
            }
            return 0;
          } else if (isPro1) {
            return -1;
          } else if (isPro2) {
            return 1;
          }
          return 0;
        };
        return this.collection.sort();
      }

      onRender() {
        return console.log(this.model.attributes.categories, 'modelo do render');
      }

    };

    MainUnidadeLayout.prototype.template = '#unidade-progresso-main';

    MainUnidadeLayout.prototype.childView = ItemView;

    MainUnidadeLayout.prototype.childViewContainer = '.listaCasos';

    MainUnidadeLayout.prototype.className = 'container-fluid selecao-main unidade-main';

    MainUnidadeLayout.prototype.events = {
      'click .gotoFinalUnidade': 'gotoFinalUnidade',
      'click .gotoInicialUnidade': 'gotoInicialUnidade',
      'click .gotoVideo': 'gotoVideo'
    };

    return MainUnidadeLayout;

  }).call(this);
});
