// Generated by CoffeeScript 2.7.0
define(['marionette'], function(Marionette) {
  var ItemListaCaso;
  return ItemListaCaso = (function() {
    class ItemListaCaso extends Marionette.ItemView {
      initialize() {
        var g, lockTesteFinal, progresso, rs, user;
        ({user, progresso} = App);
        if (user) {
          rs = progresso.where({
            'atividade': this.model.get('_id')
          }).map(function(i) {
            return i.attributes;
          });
          g = progresso.geral;
          lockTesteFinal = false;
          if (!((g.percCasosConcluTotal >= 70) && (g.percGeralAcertoCasos >= 70))) {
            lockTesteFinal = true;
          }
        }
        this.model.set({
          'respostas': rs || []
        });
        return this.model.set({lockTesteFinal});
      }

      gotoCaso() {
        var url;
        url = "comp/selecao-testes-progresso-multipro/teste-bloqueado";
        console.log(App.masterFinalLock);
        if (!App.masterFinalLock()) {
          url = App['selecao-testes-progresso'].routeFactory(this.model.get('_id'));
        }
        return Backbone.history.navigate(url, {
          trigger: true
        });
      }

      gotoInicial() {
        var _id, inicialDaPro, p, proMap, uPro;
        p = App.user.profissional;
        proMap = {
          '1': 1,
          '2': 0,
          '3': 2
        };
        uPro = proMap[p];
        inicialDaPro = App.testes.filter(function(d) {
          return /inicial/img.test(d.get('titulo')) && d.get('pro')[uPro];
        })[0];
        if (!inicialDaPro) {
          Backbone.history.navigate("comp/selecao-testes-progresso", {
            trigger: true
          });
        }
        _id = inicialDaPro.get('_id');
        return Backbone.history.navigate(`comp/teste-progresso/${_id}`, {
          trigger: true
        });
      }

      gotoFinal() {
        var _id, finalDaPro, p, proMap, uPro;
        p = App.user.profissional;
        proMap = {
          '1': 1,
          '2': 0,
          '3': 2,
          '0': 9
        };
        uPro = proMap[p];
        if ((uPro === 9) || App.masterFinalLock()) {
          return Backbone.history.navigate("comp/selecao-testes-progresso-multipro/teste-bloqueado", {
            trigger: true
          });
        }
        finalDaPro = App.testes.filter(function(d) {
          return /final/img.test(d.get('titulo')) && d.get('pro')[uPro];
        })[0];
        _id = finalDaPro.get('_id');
        return Backbone.history.navigate(`comp/teste-progresso/${_id}`, {
          trigger: true
        });
      }

      onRender() {}

    };

    ItemListaCaso.prototype.template = '#selecao-testes-progresso-itemView';

    ItemListaCaso.prototype.className = 'item-lista-caso-selecao-progresso';

    ItemListaCaso.prototype.events = {
      'click': 'gotoCaso',
      'click .gotoInicial': 'gotoInicial',
      'click .gotoFinal': 'gotoFinal'
    };

    return ItemListaCaso;

  }).call(this);
});
