// Generated by CoffeeScript 2.7.0
define(['./controller', './routes', 'utils', 'backbone'], function(controller, routes, utils, Backbone) {
  return function(component, parentApp, Backbone, Marionette, $, _) {
    var key, path, prefixedRoutes, val;
    prefixedRoutes = {};
    for (key in routes) {
      val = routes[key];
      path = `comp/${this.moduleName}${key}`;
      prefixedRoutes[path] = val;
    }
    parentApp.appRouter.processAppRoutes(controller, prefixedRoutes);
    return parentApp.on('beforeStart', function() {
      var respKey, respostas, usr;
      if (parentApp.local) {
        usr = parentApp.local.get('user');
        if (usr) {
          if (usr.cpf) {
            if (!utils.valCPF(usr.cpf)) {
              alert('O CPF informado no seu cadastro parece estar incorreto.\nVocê precisará preencher o formulário de cadastro novamente.\nPreencha com os campos com atenção e volte a responder as questões.\nBons estudos!');
              parentApp.local.set('user');
              parentApp.local.set(`respostas-${usr.cpf}`);
              return window.location.href = '#comp/cadastro';
            }
          }
          parentApp.user = usr;
        }
      }
      if (parentApp.user) {
        respKey = `respostas-${App.user.cpf}`;
        respostas = parentApp.local.get(respKey);
        // console.log "terminal-main:: parentApp.on 'beforeStart', ()->", usr, respostas
        $('.dropdown-componentes').find('ul.dropdown-menu li').show();
        parentApp.progresso.setUser(parentApp.user);
        return parentApp.progresso.reset(respostas);
      } else {
        return $('.dropdown-componentes').find('ul.dropdown-menu li').each(function(idx, el) {
          var $el;
          $el = $(el);
          if ($el.find('a').attr('href').includes('progresso')) {
            return $el.hide();
          }
        });
      }
    });
  };
});
